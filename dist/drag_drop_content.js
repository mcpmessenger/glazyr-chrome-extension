(()=>{"use strict";console.log("Glazyr Drag and Drop Content Script injected."),document.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),document.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),document.addEventListener("drop",function(e){if(e.preventDefault(),e.stopPropagation(),(function(){try{const e=window.__glazyrPolicy||{},t=Array.isArray(e.allowedDomains)?e.allowedDomains:[],o=String(location.hostname||""),r=e=>{let t=String(e||"").trim().toLowerCase();return t.startsWith("http://")?t=t.slice(7):t.startsWith("https://")&&(t=t.slice(8)),t=t.split("/")[0],t=t.split(":")[0],t},a=(e,t)=>{if(e=r(e),t=r(t),!e||!t)return!1;if("*"===t)return!0;if(t.startsWith("*.")){const o=t.slice(2);return e===o||e.endsWith("."+o)}return e===t||e.endsWith("."+t)};if(e.killSwitchEngaged)return alert("Glazyr blocked: kill switch is engaged."),!1;if(t.length&&!t.some((e=>a(o,e))))return alert("Glazyr blocked: domain is not in allowed domains."),!1;return!0}catch{return!0}})()&&(e.dataTransfer&&e.dataTransfer.files.length>0)){const r=e.dataTransfer.files[0];if(r.type.startsWith("image/")){console.log("Image file dropped:",r.name);const e=new FileReader;e.onload=e=>{const t=e.target?.result;chrome.runtime.sendMessage({type:"IMAGE_FOR_ANALYSIS",source:"drag_drop",dataUrl:t,mimeType:r.type},e=>{chrome.runtime.lastError?console.error("Error sending image for analysis:",chrome.runtime.lastError.message):(console.log("Image data sent to background:",e),alert(`Glazyr received image: ${r.name}. Sending to AI for analysis...`))})},e.readAsDataURL(r)}else console.log("Dropped file is not an image:",r.type)}else if(e.dataTransfer&&e.dataTransfer.getData("text/html")){const r=e.dataTransfer.getData("text/html"),t=document.createElement("div");t.innerHTML=r;const a=t.querySelector("img");a&&a.src&&(console.log("Image element dragged:",a.src),chrome.runtime.sendMessage({type:"IMAGE_FOR_ANALYSIS",source:"drag_element",imageUrl:a.src},e=>{chrome.runtime.lastError?console.error("Error sending image URL for analysis:",chrome.runtime.lastError.message):(console.log("Image URL sent to background:",e),alert(`Glazyr received image URL: ${a.src}. Sending to AI for analysis...`))}))}},!1)})();